plugins {
    id 'groovy'
    id 'org.unbroken-dome.test-sets' version '4.0.0'
}

group 'it.zebco'
version '2.0.0'

/*
sourceSets {
    main {
        groovy {
            srcDirs = ['src/main/groovy', 'src/main/java']
        }
        java {
            srcDirs = []
        }
    }

    test {
        groovy {
            srcDirs = ['src/test/groovy','src/test/java']
        }
        java {
            srcDirs = []
        }
    }
}
 */

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
    flatDir {
        dirs 'D:/Workspace/IKAN-PHASE/libs'
    }
    maven {
        name = 'almRepoLocal'
        url = "file://D:/Workspace/IKAN-PHASE/mvn_repo"
    }
}

dependencies {
    implementation 'org.codehaus.groovy:groovy-all:3.0.13'
    // logback-classic -> core & slf4j. If explicit, binging so slf4j simple logging instead of logback logger
    implementation 'ch.qos.logback:logback-classic:1.3.5'
    implementation 'org.apache.ant:ant:1.9.3'
    // https://mvnrepository.com/artifact/org.apache.commons/commons-lang3
    implementation 'org.apache.commons:commons-lang3:3.12.0'
    // https://mvnrepository.com/artifact/org.apache.commons/commons-exec
    implementation 'org.apache.commons:commons-exec:1.3'
    testImplementation 'org.spockframework:spock-core:2.0-groovy-3.0'
    // required for having a real svn server to test against
    testImplementation "org.testcontainers:spock:1.17.6"
}

task fatJar(type: Jar) {
    manifest {
        attributes 'Implementation-Title': 'Common Utils',
                'Implementation-Version': version
    }
    baseName = 'svn-adapter'
    from {
        (configurations.runtime - configurations.provided).collect {
            it.isDirectory() ? it : zipTree(it)
        }
    } {
        exclude "**/Exercise*.*"
    }
    with jar
}

// show stdout when executing test. Other methods available
test {
    testLogging {
        showStandardStreams = true
    }
}

test {
    useJUnitPlatform()
}

// Make all tests use JUnit 5
tasks.withType(Test) {
    useJUnitPlatform()
}

testSets {
    integrationTest
}